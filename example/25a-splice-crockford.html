<!DOCTYPE html>
<html>
  <head>
      <style>
          * {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
          }
        </style>
  </head>
  <body>
      <h2>Test Drive splice()</h2>
      <h3 id="stats"></h3>
      <script src="../simpletest.js"></script>
      <script>

        function splice (arr, start, deleteCount) {
          var max = Math.max,
              min = Math.min,
              delta,
              element,
              /* 
              insertCount è il numero di elementi da inserire

              se ho 2 argomenti
                2-2 > 0
              se ho 3 argomenti, significa che devo inserire 1 elemento
                3-2 >>> 1
              se ho 1 argomento
                1-2 >>> 0, non devo inserire alcun argomento.
                se non avesse messo max... ma solo arguments.length - 2, nel caso di 1 argomento avrebbe avuto insertCount = -1
               */
              insertCount = max(arguments.length - 3, 0),
              k = 0, // ?
              len = arr.length,
              new_len, // newLen
              result = [],
              shift_count; // shiftCount
              
              // se start passed in, usa start, altrimenti usa 0
              start = start || 0;
              if (start < 0) {
                /* 
                  se len == 5 e start == -2 >>> start = 3
                  se len == 5 e start == -6 >>> start = -1
                */
                start += len;
              }
              /*
              if (start < 0) start = 0
              if (start > 0) start = start
              >>> start = max(0, start)

              if (start > len) start = len
              if (start < len) start = start
              >>> start = min(start, len)

              start, l'indice da cui partire a rimuovere ed aggiungere elementi, non può essere negativo, questo mi dice max tra due valori di cui uno è 0. se min è positivo, start sarà min, altrimenti 0. min quindi può essere negativo. min(start, len) mi dice che il limite superiore di s
               */
              start = max(min(start, len), 0);
              // calcola quanti elementi rimuovere
              deleteCount = max(min(typeof deleteCount === 'number' ? deleteCount : len, len - start), 0);
              /* 
              [1, 2, 3, 4]
              deleteCount = 2
               */
              delta = insertCount - deleteCount;
              new_len = len + delta;
              while (k < deleteCount) {
                element = arr[start + k];
                if (element !== undefined) {
                  result[k] = element;
                }
                k += 1;
              }
              shift_count = len - start - deleteCount;
              if (delta < 0) {
                k = start + insertCount;
                while (shift_count) {
                  arr[k] = arr[k - delta];
                  k += 1;
                  shift_count -= 1;
                }
                arr.length = new_len;
              } else if (delta > 0) {
                k = 1;
                while (shift_count) {
                  arr[new_len - k] = arr[len - k];
                  k += 1;
                  shift_count -= 1;
                }
                arr.length = new_len;
              }
              for (k = 0; k < insertCount; k += 1) {
                arr[start + k] = arguments[k + 2];
              }
              return result;
            }



        

        /* TESTS */
        SimpleTest.runTests({
          
        });
      </script>
  </body>
</html>


